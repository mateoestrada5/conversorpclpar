<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <title>Conversor de Monedas Pro</title>
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üí±</text></svg>">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    * {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
    }

    .conversion-value {
      min-width: 180px;
      max-width: 100%;
      word-break: break-word;
    }

    .result-amount {
      font-size: clamp(1.5rem, 5vw, 2.5rem);
      line-height: 1.2;
    }

    @media (max-width: 640px) {
      .result-amount {
        font-size: clamp(1.25rem, 6vw, 2rem);
      }

      .compact-header {
        padding-top: 0.5rem;
        padding-bottom: 0.5rem;
      }

      .compact-input {
        padding-top: 0.5rem;
        padding-bottom: 0.5rem;
      }
    }
  </style>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#007aff',
            success: '#30d158',
            warning: '#ff9500',
            danger: '#ff3b30',
          }
        }
      }
    }
  </script>
</head>

<body class="bg-gray-50 min-h-screen">
  <header class="bg-white border-b border-gray-200 sticky top-0 z-10 shadow-sm compact-header">
    <div class="max-w-7xl mx-auto px-4 py-2 sm:py-3">
      <h1 class="text-base sm:text-xl font-semibold text-gray-900 text-center sm:text-left">
        üí± Conversor de Monedas
      </h1>
      <p class="text-xs text-gray-600 text-center sm:text-left mt-0.5">
        USD ‚Ä¢ EUR ‚Ä¢ CLP ‚Ä¢ ARS ‚Ä¢ BRL
      </p>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-3 sm:px-4 py-3 sm:py-5">

    <div id="alert-container" class="mb-3 hidden" role="alert">
      <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
        <div class="flex items-center space-x-2">
          <svg class="w-5 h-5 text-yellow-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z">
            </path>
          </svg>
          <span id="alert-text" class="text-yellow-800 text-sm font-medium"></span>
        </div>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-3 sm:gap-4">

      <aside class="lg:col-span-3 bg-white rounded-lg shadow border border-gray-200 p-3">
        <h2 class="text-xs sm:text-sm font-semibold text-gray-900 mb-2 flex items-center justify-center gap-2">
          <svg class="w-4 h-4 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6">
            </path>
          </svg>
          <span>Cotizaciones</span>
        </h2>
        
        <p class="text-[10px] text-gray-500 text-center mb-1 italic">
          * Todas las cotizaciones referenciadas al USD
        </p>

        <div class="grid grid-cols-2 gap-1 lg:grid-cols-1 lg:gap-0 lg:space-y-1 max-w-[280px] mx-auto lg:max-w-none" id="cotizaciones-container">
        </div>

        <div id="status" class="text-center text-xs text-gray-500 mt-2">
          Cargando...
        </div>
      </aside>

      <section class="lg:col-span-5 bg-white rounded-lg shadow border border-gray-200 p-3 sm:p-4">
        <h2 class="text-sm sm:text-base font-semibold text-gray-900 mb-3 flex items-center justify-center gap-2">
          <svg class="w-4 h-4 sm:w-5 sm:h-5 text-success" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"></path>
          </svg>
          <span>Convertir</span>
        </h2>

        <form id="converter-form" onsubmit="handleConversion(event)" class="space-y-3">
          <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-2">
            <select id="currency-from" onchange="handleCurrencyChange()"
              class="flex-1 px-2 py-1.5 sm:px-3 sm:py-2 text-xs sm:text-sm bg-gray-50 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
              required>
              <option value="USD">üá∫üá∏ D√≥lar</option>
              <option value="EUR">üá™üá∫ Euro</option>
              <option value="CLP">üá®üá± Peso Chileno</option>
              <option value="ARS">üá¶üá∑ Peso Argentino</option>
              <option value="BRL">üáßüá∑ Real Brasile√±o</option>
            </select>

            <button type="button" onclick="swapCurrencies()"
              class="p-1.5 sm:p-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors self-center"
              aria-label="Intercambiar monedas">
              <svg class="w-4 h-4 text-gray-600 transform rotate-90 sm:rotate-0" fill="none" stroke="currentColor"
                viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path>
              </svg>
            </button>

            <select id="currency-to" onchange="handleCurrencyChange()"
              class="flex-1 px-2 py-1.5 sm:px-3 sm:py-2 text-xs sm:text-sm bg-gray-50 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
              required>
              <option value="ARS">üá¶üá∑ Peso Argentino</option>
              <option value="USD">üá∫üá∏ D√≥lar</option>
              <option value="EUR">üá™üá∫ Euro</option>
              <option value="CLP">üá®üá± Peso Chileno</option>
              <option value="BRL">üáßüá∑ Real Brasile√±o</option>
            </select>
          </div>

          <div>
            <label for="amount-input" class="block text-xs font-medium text-gray-700 mb-1" id="amount-label">
              Monto
            </label>
            <div class="relative">
              <span
                class="absolute left-2 sm:left-3 top-1/2 -translate-y-1/2 text-gray-500 text-xs sm:text-sm font-medium"
                id="currency-symbol">
                USD
              </span>
              <input type="number" id="amount-input" placeholder="1000" min="0" step="any"
                class="w-full pl-12 sm:pl-14 pr-2 py-1.5 sm:py-2 text-xs sm:text-sm font-medium bg-gray-50 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary compact-input"
                required>
            </div>
          </div>

          <div class="grid grid-cols-4 gap-1.5 sm:gap-2" id="quick-amounts">
          </div>

          <button type="submit"
            class="w-full bg-primary hover:bg-blue-600 text-white font-semibold py-2 sm:py-2.5 px-4 rounded-lg transition-all transform hover:scale-[1.01] active:scale-[0.99] shadow-md hover:shadow-lg text-sm">
            üí± Convertir
          </button>
        </form>
      </section>

      <section
        class="lg:col-span-4 bg-gradient-to-br from-white to-gray-50 rounded-lg shadow-lg border-2 border-gray-200 p-3 sm:p-4 flex items-center justify-center min-h-[240px] sm:min-h-[280px]">
        <div id="result-container" class="w-full">
          <div class="text-center space-y-2">
            <div class="inline-flex items-center justify-center w-10 h-10 sm:w-12 sm:h-12 bg-gray-100 rounded-full">
              <svg class="w-5 h-5 sm:w-6 sm:h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z">
                </path>
              </svg>
            </div>
            <p class="text-gray-500 font-medium text-xs sm:text-sm">Resultado</p>
            <p class="text-gray-400 text-xs">Ingresa un monto</p>
          </div>
        </div>
      </section>
    </div>

    <section class="mt-4 sm:mt-6 bg-white rounded-lg shadow border border-gray-200 p-3 sm:p-5">
      <div class="flex items-center justify-center mb-3">
        <h2 class="text-base sm:text-lg font-semibold text-gray-900 flex items-center gap-2">
          <svg class="w-4 h-4 sm:w-5 sm:h-5 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z">
            </path>
          </svg>
          <span>Historial</span>
        </h2>
      </div>

      <div class="flex justify-center mb-3">
        <div class="inline-flex rounded-lg bg-gray-100 p-1" role="tablist">
          <button type="button" onclick="toggleHistoryView('history')" id="btn-history"
            class="px-3 py-1.5 text-xs sm:text-sm font-medium bg-purple-500 text-white rounded-md transition-all">
            üìã Historial
          </button>
          <button type="button" onclick="toggleHistoryView('chart')" id="btn-chart"
            class="px-3 py-1.5 text-xs sm:text-sm font-medium text-gray-600 rounded-md transition-all">
            üìä Gr√°fico
          </button>
        </div>
      </div>

      <div id="history-container" class="space-y-2 max-h-80 overflow-y-auto">
        <p class="text-center text-gray-500 text-xs sm:text-sm py-6">No hay conversiones a√∫n</p>
      </div>

      <div id="chart-container" class="hidden">
        <div class="h-56 sm:h-64">
          <canvas id="rates-chart"></canvas>
        </div>
      </div>
    </section>

    <section class="mt-4 sm:mt-6 bg-white rounded-lg shadow border border-gray-200 p-3 sm:p-5">
      <h2
        class="text-base sm:text-lg font-semibold text-gray-900 mb-3 text-center flex items-center justify-center gap-2">
        <svg class="w-4 h-4 sm:w-5 sm:h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z">
          </path>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z">
          </path>
        </svg>
        <span>Configuraci√≥n</span>
      </h2>

      <div class="grid sm:grid-cols-2 gap-3 sm:gap-4">
        <div class="space-y-2">
          <h3 class="text-xs sm:text-sm font-medium text-gray-700">Actualizar Cotizaciones</h3>
          <button type="button" onclick="fetchExchangeRates()"
            class="w-full bg-primary hover:bg-blue-600 text-white font-medium py-2 px-3 rounded-lg transition-all shadow hover:shadow-md text-xs sm:text-sm">
            üîÑ Actualizar desde APIs
          </button>
        </div>

        <div class="space-y-2">
          <h3 class="text-xs sm:text-sm font-medium text-gray-700">Alertas de Cotizaci√≥n</h3>
          <p class="text-[10px] text-gray-500 italic">* Referencia: 1 USD</p>
          <form onsubmit="handleAlertConfig(event)" class="space-y-2">
            <div class="flex gap-2">
              <select id="alert-currency"
                class="flex-1 px-2 py-1.5 text-xs sm:text-sm bg-gray-50 border border-gray-300 rounded-lg" required>
                <option value="CLP">CLP</option>
                <option value="ARS">ARS</option>
                <option value="EUR">EUR</option>
                <option value="BRL">BRL</option>
              </select>
              <select id="alert-condition"
                class="px-3 py-1.5 text-xs sm:text-sm bg-gray-50 border border-gray-300 rounded-lg" required>
                <option value="above">Cuando supere</option>
                <option value="below">Cuando est√© por debajo de</option>
              </select>
            </div>
            <input type="number" id="alert-value" placeholder="Valor" step="0.01" min="0"
              class="w-full px-2 py-1.5 text-xs sm:text-sm bg-gray-50 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-warning"
              required>
            <button type="submit"
              class="w-full bg-warning hover:bg-orange-600 text-white font-medium py-2 px-3 rounded-lg transition-all shadow hover:shadow-md text-xs sm:text-sm">
              Configurar
            </button>
          </form>
        </div>
      </div>
    </section>

    <footer class="text-center mt-4 sm:mt-6 text-gray-500 text-xs">
      <p>Datos de DolarAPI, Mindicador y APIs internacionales</p>
    </footer>
  </main>

  <script>
    const appState = {
      rates: { USD: 1, EUR: 0, CLP: 0, ARS: 0, BRL: 0 },
      currencyFrom: 'USD',
      currencyTo: 'ARS',
      history: JSON.parse(localStorage.getItem('conversionHistory')) || [],
      ratesHistory: JSON.parse(localStorage.getItem('ratesHistory')) || [],
      alerts: JSON.parse(localStorage.getItem('alerts')) || []
    };

    const CURRENCIES = {
      USD: { name: 'D√≥lar', symbol: 'USD', flag: 'üá∫üá∏', quickAmounts: [100, 500, 1000, 5000] },
      EUR: { name: 'Euro', symbol: 'EUR', flag: 'üá™üá∫', quickAmounts: [100, 500, 1000, 5000] },
      CLP: { name: 'Peso Chileno', symbol: 'CLP', flag: 'üá®üá±', quickAmounts: [100000, 500000, 1000000, 5000000] },
      ARS: { name: 'Peso Argentino', symbol: 'ARS', flag: 'üá¶üá∑', quickAmounts: [10000, 50000, 100000, 500000] },
      BRL: { name: 'Real Brasile√±o', symbol: 'BRL', flag: 'üáßüá∑', quickAmounts: [100, 500, 1000, 5000] }
    };

    document.addEventListener('DOMContentLoaded', () => {
      fetchExchangeRates();
      updateCurrencyUI();
      renderHistory();
      initializeChart();
    });

    async function fetchExchangeRates() {
      try {
        updateStatus('loading');

        const [arsData, clpData, eurData] = await Promise.all([
          fetch('https://dolarapi.com/v1/dolares/oficial').then(r => r.json()),
          fetch('https://mindicador.cl/api/dolar').then(r => r.json()),
          fetch('https://api.exchangerate-api.com/v4/latest/USD').then(r => r.json())
        ]);

        appState.rates.ARS = arsData.venta;
        appState.rates.CLP = clpData.serie[0].valor;
        appState.rates.EUR = 1 / eurData.rates.EUR;
        appState.rates.BRL = eurData.rates.BRL;

        saveRatesToHistory();
        renderExchangeRates();
        updateChart();
        checkAlerts();
        updateStatus('success');
        showNotification('Cotizaciones actualizadas', 'success');

      } catch (error) {
        console.error('Error fetching rates:', error);
        updateStatus('error');
        showNotification('Error al cargar cotizaciones', 'error');
      }
    }

    function saveRatesToHistory() {
      const today = new Date().toISOString().split('T')[0];
      const newEntry = {
        date: today,
        rates: { ...appState.rates },
        timestamp: Date.now()
      };

      appState.ratesHistory = appState.ratesHistory.filter(e => e.date !== today);
      appState.ratesHistory.push(newEntry);
      appState.ratesHistory = appState.ratesHistory.slice(-7);

      localStorage.setItem('ratesHistory', JSON.stringify(appState.ratesHistory));
    }

    function renderExchangeRates() {
      const container = document.getElementById('cotizaciones-container');
      const ratesToDisplay = ['CLP', 'ARS', 'EUR', 'BRL'];

      container.innerHTML = ratesToDisplay.map(currency => {
        const config = CURRENCIES[currency];
        const rate = appState.rates[currency];
        const colors = {
          CLP: 'blue',
          ARS: 'green',
          EUR: 'purple',
          BRL: 'yellow'
        };
        const color = colors[currency];

        return `
          <div class="bg-gradient-to-br from-${color}-50 to-${color}-100/50 rounded p-0.5 sm:p-2">
            <div class="flex items-center justify-between gap-0.5 text-[9px] sm:text-xs">
              <span class="font-medium text-gray-700 truncate">üá∫üá∏‚Üí${config.flag}</span>
              <span class="font-bold text-${color}-600 shrink-0">${rate.toFixed(2)}</span>
            </div>
          </div>
        `;
      }).join('');
    }

    function updateStatus(state) {
      const statusEl = document.getElementById('status');
      const time = new Date().toLocaleString('es-CL', { hour: '2-digit', minute: '2-digit' });

      const states = {
        loading: { icon: '‚è≥', text: 'Cargando...', color: 'text-gray-500' },
        success: { icon: '‚úì', text: `Cotizaciones cargadas a las ${time}`, color: 'text-green-500' },
        error: { icon: '‚úó', text: 'Error al cargar', color: 'text-red-500' }
      };

      const s = states[state];
      statusEl.innerHTML = `<span class="${s.color}">${s.icon} ${s.text}</span>`;
    }

    function handleConversion(event) {
      event.preventDefault();

      const amount = parseFloat(document.getElementById('amount-input').value);
      const from = appState.currencyFrom;
      const to = appState.currencyTo;

      if (isNaN(amount) || amount <= 0) {
        displayError('Ingresa un monto v√°lido');
        return;
      }

      if (appState.rates[from] === 0 || appState.rates[to] === 0) {
        displayError('Cargando cotizaciones...');
        return;
      }

      const result = convertCurrency(amount, from, to);
      displayResult(amount, from, result, to);
      saveToHistory(amount, from, result, to);
    }

    function convertCurrency(amount, from, to) {
      const amountInUSD = from === 'USD' ? amount : amount / appState.rates[from];
      return to === 'USD' ? amountInUSD : amountInUSD * appState.rates[to];
    }

    function displayResult(fromAmount, fromCurrency, toAmount, toCurrency) {
      const fromConfig = CURRENCIES[fromCurrency];
      const toConfig = CURRENCIES[toCurrency];
      const container = document.getElementById('result-container');

      container.innerHTML = `
        <div class="space-y-2 sm:space-y-3">
          <div class="flex items-center justify-center gap-2 text-success">
            <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <span class="text-xs sm:text-sm font-semibold">Exitosa</span>
          </div>
          
          <div class="bg-gradient-to-br from-blue-50 to-blue-100/50 rounded-lg p-2 sm:p-3 shadow-sm">
            <p class="text-xs text-gray-600 mb-1 font-medium">Convertiste</p>
            <div class="conversion-value mx-auto">
              <p class="result-amount font-bold text-blue-600 text-center break-words">
                ${formatNumber(fromAmount, 2)}
              </p>
              <p class="text-xs sm:text-sm text-gray-600 font-medium text-center mt-1">${fromConfig.symbol}</p>
            </div>
          </div>
          
          <div class="flex justify-center">
            <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
            </svg>
          </div>
          
          <div class="bg-gradient-to-br from-green-50 to-green-100/50 rounded-lg p-3 sm:p-4 shadow-md border-2 border-green-200">
            <p class="text-xs text-gray-600 mb-1 font-medium">Obtienes</p>
            <div class="conversion-value mx-auto">
              <p class="result-amount font-bold text-success text-center break-words">
                ${formatNumber(toAmount, 2)}
              </p>
              <p class="text-sm text-gray-700 font-semibold text-center mt-1">${toConfig.symbol}</p>
            </div>
          </div>
        </div>
      `;
    }

    function displayError(message) {
      const container = document.getElementById('result-container');
      container.innerHTML = `
        <div class="space-y-2 text-center">
          <div class="inline-flex items-center justify-center w-10 h-10 sm:w-12 sm:h-12 bg-red-100 rounded-full">
            <svg class="w-5 h-5 sm:w-6 sm:h-6 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
            </svg>
          </div>
          <p class="text-red-600 font-semibold text-xs sm:text-sm">${message}</p>
        </div>
      `;
    }

    function formatNumber(num, decimals = 0) {
      return new Intl.NumberFormat('es-CL', {
        minimumFractionDigits: decimals,
        maximumFractionDigits: decimals
      }).format(num);
    }

    function handleCurrencyChange() {
      appState.currencyFrom = document.getElementById('currency-from').value;
      appState.currencyTo = document.getElementById('currency-to').value;
      updateCurrencyUI();
    }

    function swapCurrencies() {
      const temp = appState.currencyFrom;
      appState.currencyFrom = appState.currencyTo;
      appState.currencyTo = temp;

      document.getElementById('currency-from').value = appState.currencyFrom;
      document.getElementById('currency-to').value = appState.currencyTo;

      updateCurrencyUI();
    }

    function updateCurrencyUI() {
      const currency = CURRENCIES[appState.currencyFrom];
      document.getElementById('amount-label').textContent = `Monto en ${currency.name}`;
      document.getElementById('currency-symbol').textContent = currency.symbol;
      renderQuickAmounts();
    }

    function renderQuickAmounts() {
      const container = document.getElementById('quick-amounts');
      const amounts = CURRENCIES[appState.currencyFrom].quickAmounts;

      container.innerHTML = amounts.map(amount => {
        const label = amount >= 1000000 ? `${amount / 1000000}M` :
          amount >= 1000 ? `${amount / 1000}K` : amount;

        return `
          <button 
            type="button"
            onclick="setQuickAmount(${amount})" 
            class="px-1.5 py-1.5 sm:px-2 sm:py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-xs font-medium transition-colors"
          >
            ${label}
          </button>
        `;
      }).join('');
    }

    function setQuickAmount(amount) {
      document.getElementById('amount-input').value = amount;
    }

    function saveToHistory(fromAmount, fromCurrency, toAmount, toCurrency) {
      const entry = {
        id: Date.now(),
        fromAmount,
        fromCurrency,
        toAmount,
        toCurrency,
        timestamp: Date.now()
      };

      appState.history.unshift(entry);
      appState.history = appState.history.slice(0, 10);

      localStorage.setItem('conversionHistory', JSON.stringify(appState.history));
      renderHistory();
    }

    function renderHistory() {
      const container = document.getElementById('history-container');

      if (appState.history.length === 0) {
        container.innerHTML = '<p class="text-center text-gray-500 text-xs sm:text-sm py-6">No hay conversiones a√∫n</p>';
        return;
      }

      container.innerHTML = appState.history.map(entry => `
        <div class="bg-gradient-to-r from-gray-50 to-gray-100/50 rounded-lg p-2 sm:p-3 hover:shadow transition-shadow">
          <div class="flex justify-between items-center gap-2">
            <div class="flex items-center gap-1 sm:gap-2 flex-1 min-w-0 text-xs sm:text-sm">
              <span class="font-semibold text-blue-600 truncate">
                ${formatNumber(entry.fromAmount)} ${entry.fromCurrency}
              </span>
              <svg class="w-3 h-3 sm:w-4 sm:h-4 text-gray-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
              </svg>
              <span class="font-bold text-success truncate">
                ${formatNumber(entry.toAmount)} ${entry.toCurrency}
              </span>
            </div>
            <button 
              type="button"
              onclick="repeatConversion(${entry.id})" 
              class="p-1 text-primary hover:bg-blue-50 rounded-lg transition-colors flex-shrink-0"
              title="Repetir"
            >
              <svg class="w-3 h-3 sm:w-4 sm:h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
              </svg>
            </button>
          </div>
          <p class="text-gray-400 text-xs mt-1">
            ${new Date(entry.timestamp).toLocaleString('es-CL', {
        month: 'short',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      })}
          </p>
        </div>
      `).join('');
    }

    function repeatConversion(id) {
      const entry = appState.history.find(e => e.id === id);
      if (!entry) return;

      document.getElementById('currency-from').value = entry.fromCurrency;
      document.getElementById('currency-to').value = entry.toCurrency;
      document.getElementById('amount-input').value = entry.fromAmount;

      appState.currencyFrom = entry.fromCurrency;
      appState.currencyTo = entry.toCurrency;

      updateCurrencyUI();
      document.getElementById('converter-form').dispatchEvent(new Event('submit'));
    }

    let chartInstance = null;

    function initializeChart() {
      const ctx = document.getElementById('rates-chart').getContext('2d');

      chartInstance = new Chart(ctx, {
        type: 'line',
        data: {
          labels: [],
          datasets: [
            { label: 'USD ‚Üí CLP', data: [], borderColor: '#3b82f6', backgroundColor: 'rgba(59, 130, 246, 0.1)', tension: 0.4 },
            { label: 'USD ‚Üí ARS', data: [], borderColor: '#10b981', backgroundColor: 'rgba(16, 185, 129, 0.1)', tension: 0.4 },
            { label: 'USD ‚Üí EUR', data: [], borderColor: '#8b5cf6', backgroundColor: 'rgba(139, 92, 246, 0.1)', tension: 0.4 },
            { label: 'USD ‚Üí BRL', data: [], borderColor: '#f59e0b', backgroundColor: 'rgba(245, 158, 11, 0.1)', tension: 0.4 }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: { mode: 'index', intersect: false },
          plugins: { legend: { display: true, position: 'top' } },
          scales: { y: { beginAtZero: false } }
        }
      });

      updateChart();
    }

    function updateChart() {
      if (!chartInstance || appState.ratesHistory.length === 0) return;

      const labels = appState.ratesHistory.map(e =>
        new Date(e.date).toLocaleDateString('es-CL', { month: 'short', day: 'numeric' })
      );

      chartInstance.data.labels = labels;
      chartInstance.data.datasets[0].data = appState.ratesHistory.map(e => e.rates.CLP);
      chartInstance.data.datasets[1].data = appState.ratesHistory.map(e => e.rates.ARS);
      chartInstance.data.datasets[2].data = appState.ratesHistory.map(e => e.rates.EUR);
      chartInstance.data.datasets[3].data = appState.ratesHistory.map(e => e.rates.BRL);

      chartInstance.update();
    }

    function toggleHistoryView(view) {
      const historyBtn = document.getElementById('btn-history');
      const chartBtn = document.getElementById('btn-chart');
      const historyContainer = document.getElementById('history-container');
      const chartContainer = document.getElementById('chart-container');

      if (view === 'history') {
        historyBtn.className = 'px-3 py-1.5 text-xs sm:text-sm font-medium bg-purple-500 text-white rounded-md transition-all';
        chartBtn.className = 'px-3 py-1.5 text-xs sm:text-sm font-medium text-gray-600 rounded-md transition-all';
        historyContainer.classList.remove('hidden');
        chartContainer.classList.add('hidden');
      } else {
        historyBtn.className = 'px-3 py-1.5 text-xs sm:text-sm font-medium text-gray-600 rounded-md transition-all';
        chartBtn.className = 'px-3 py-1.5 text-xs sm:text-sm font-medium bg-purple-500 text-white rounded-md transition-all';
        historyContainer.classList.add('hidden');
        chartContainer.classList.remove('hidden');
        if (chartInstance) chartInstance.resize();
      }
    }

    function handleAlertConfig(event) {
      event.preventDefault();

      const currency = document.getElementById('alert-currency').value;
      const condition = document.getElementById('alert-condition').value;
      const value = parseFloat(document.getElementById('alert-value').value);

      if (isNaN(value) || value <= 0) {
        showNotification('Ingresa un valor v√°lido', 'error');
        return;
      }

      const alert = {
        id: Date.now(),
        currency,
        condition,
        value,
        active: true
      };

      appState.alerts.push(alert);
      localStorage.setItem('alerts', JSON.stringify(appState.alerts));

      showNotification(
        `Alerta: USD ‚Üí ${currency} ${condition === 'above' ? '>' : '<'} ${value}`,
        'success'
      );

      event.target.reset();
    }

    function checkAlerts() {
      appState.alerts.forEach(alert => {
        if (!alert.active) return;

        const currentRate = appState.rates[alert.currency];
        const triggered = alert.condition === 'above'
          ? currentRate > alert.value
          : currentRate < alert.value;

        if (triggered) {
          showAlert(
            `¬°Alerta! USD ‚Üí ${alert.currency} ${alert.condition === 'above' ? 'super√≥' : 'baj√≥ de'} ${alert.value}`
          );
          alert.active = false;
        }
      });

      localStorage.setItem('alerts', JSON.stringify(appState.alerts));
    }

    function showAlert(message) {
      const container = document.getElementById('alert-container');
      const textEl = document.getElementById('alert-text');

      textEl.textContent = message;
      container.classList.remove('hidden');

      setTimeout(() => container.classList.add('hidden'), 5000);
    }

    function showNotification(message, type = 'info') {
      const bgColors = {
        success: 'bg-green-500',
        error: 'bg-red-500',
        info: 'bg-blue-500'
      };

      const icons = {
        success: 'M5 13l4 4L19 7',
        error: 'M6 18L18 6M6 6l12 12',
        info: 'M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z'
      };

      const notification = document.createElement('div');
      notification.className = `fixed top-4 right-4 z-50 p-3 sm:p-4 rounded-lg shadow-lg transform transition-all duration-300 translate-x-full ${bgColors[type]} text-white max-w-sm text-sm`;
      notification.innerHTML = `
        <div class="flex items-center gap-2">
          <svg class="w-4 h-4 sm:w-5 sm:h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${icons[type]}"></path>
          </svg>
          <span class="font-medium">${message}</span>
        </div>
      `;

      document.body.appendChild(notification);

      setTimeout(() => notification.classList.remove('translate-x-full'), 100);
      setTimeout(() => {
        notification.classList.add('translate-x-full');
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }
  </script>
</body>

</html>